<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>By Selim - AtÄ±f Zinciri GÃ¶rselleÅŸtirici</title>
  <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f7f9ff, #e9eeff);
      --text: #111;
      --card-bg: #fff;
      --accent: #2b4eff;
      --shadow: rgba(43, 78, 255, 0.15);
    }
    body.dark {
      --bg: linear-gradient(135deg, #0f1116, #1a1d23);
      --text: #eee;
      --card-bg: #1f1f1f;
      --accent: #00bfff;
      --shadow: rgba(0, 191, 255, 0.25);
    }

    body {
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
      text-align: center;
      transition: 0.5s;
    }

    h1 {
      margin-top: 20px;
      color: var(--accent);
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }

    #controls {
      margin: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    input, button, select {
      padding: 10px 14px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 3px 6px var(--shadow);
      transition: 0.3s;
    }
    button:hover { transform: translateY(-1px); opacity: 0.9; }

    #network {
      width: 90%;
      height: 550px;
      background: var(--card-bg);
      margin: 0 auto;
      border-radius: 15px;
      box-shadow: 0 0 25px var(--shadow);
      transition: all 0.4s;
      position: relative;
    }

    #status { margin: 10px; font-weight: 500; }

    #spinner {
      display: none;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      margin: 10px auto;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    #notes {
      background: rgba(43,78,255,0.07);
      padding: 12px;
      border-radius: 10px;
      max-width: 700px;
      margin: 10px auto;
      font-size: 0.9em;
    }

    footer {
      margin: 25px 0;
      font-size: 0.8em;
      color: gray;
      opacity: 0.8;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>By Selim - AtÄ±f Zinciri GÃ¶rselleÅŸtirici</h1>

  <div id="controls">
    <input id="paperInput" type="text" placeholder="Makale DOI'si (Ã¶rn: 10.1038/nature12373)" />
    <button id="searchButton">Ara</button>
    <button id="sampleButton">ğŸ² Ã–rnek DOI</button>
    <select id="yearFilter">
      <option value="all">TÃ¼m YÄ±llar</option>
      <option value="2010">2010+</option>
      <option value="2015">2015+</option>
      <option value="2020">2020+</option>
    </select>
    <button id="savePng">ğŸ’¾ PNG Kaydet</button>
    <button id="savePdf">ğŸ“„ PDF Kaydet</button>
    <button id="themeButton">ğŸŒ™ Gece Modu</button>
  </div>

  <div id="spinner"></div>
  <div id="status"></div>
  <div id="network"></div>

  <div id="notes">
    ğŸ”¹ <b>Mavi</b> dÃ¼ÄŸÃ¼mler kaynakÃ§a, <b>yeÅŸil</b> dÃ¼ÄŸÃ¼mler atÄ±f yapan makalelerdir.<br>
    ğŸ”¹ DÃ¼ÄŸÃ¼mlere tÄ±klayarak makale sayfasÄ±na gidebilirsiniz.<br>
    ğŸ”¹ AtÄ±f sayÄ±sÄ± yÃ¼ksek olanlar daha bÃ¼yÃ¼k gÃ¶rÃ¼nÃ¼r.<br>
    ğŸ”¹ Filtre menÃ¼sÃ¼nden yÄ±l aralÄ±ÄŸÄ±nÄ± seÃ§ebilirsiniz.<br>
    ğŸ”¹ Grafik yoÄŸunluÄŸuna gÃ¶re otomatik konum ayarÄ± yapÄ±lÄ±r.
  </div>

  <footer>
    Â© 2025 <b>Selim Ã–MÃœR</b> | 
    <a href="mailto:omurselim@gmail.com">omurselim@gmail.com</a> |
    TÃ¼m haklarÄ± saklÄ±dÄ±r. Ä°zinsiz kopyalanamaz veya ticari amaÃ§la kullanÄ±lamaz.
  </footer>

  <script>
    const cache = new Map();

    async function fetchWithTimeout(url, ms = 8000) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), ms);
      try {
        const res = await fetch(url, { signal: controller.signal });
        clearTimeout(timeout);
        if (!res.ok) throw new Error("HTTP Error " + res.status);
        return await res.json();
      } catch (e) {
        clearTimeout(timeout);
        return null;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("paperInput");
      const btn = document.getElementById("searchButton");
      const sampleBtn = document.getElementById("sampleButton");
      const spinner = document.getElementById("spinner");
      const status = document.getElementById("status");
      const container = document.getElementById("network");
      const savePng = document.getElementById("savePng");
      const savePdf = document.getElementById("savePdf");
      const themeBtn = document.getElementById("themeButton");
      const yearFilter = document.getElementById("yearFilter");

      let network, fullData;

      themeBtn.onclick = () => {
        document.body.classList.toggle("dark");
        themeBtn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸ GÃ¼ndÃ¼z Modu" : "ğŸŒ™ Gece Modu";
      };

      sampleBtn.onclick = () => {
        const samples = ["10.1109/5.771073","10.1038/nature12373","10.48550/arXiv.1706.03762"];
        input.value = samples[Math.floor(Math.random() * samples.length)];
        searchPaper();
      };

      input.addEventListener("keyup", e => { if (e.key === "Enter") searchPaper(); });
      btn.addEventListener("click", searchPaper);

      savePng.onclick = () => {
        if (!network) return alert("Ã–nce grafik oluÅŸturun.");
        const canvas = network.canvas.frame.canvas;
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "atif-grafik.png";
        a.click();
      };

      savePdf.onclick = () => {
        if (!network) return alert("Ã–nce grafik oluÅŸturun.");
        const canvas = network.canvas.frame.canvas;
        const pdf = new jspdf.jsPDF({ orientation: "landscape" });
        pdf.addImage(canvas.toDataURL("image/png"), "PNG", 10, 10, 270, 180);
        pdf.save("atif-grafik.pdf");
      };

      async function searchPaper() {
        const doi = input.value.trim();
        if (!doi) return (status.textContent = "âš ï¸ LÃ¼tfen DOI girin.");
        if (cache.has(doi)) {
          drawGraph(cache.get(doi));
          status.textContent = "âš¡ Ã–nceden yÃ¼klenen veri kullanÄ±ldÄ±.";
          return;
        }

        spinner.style.display = "inline-block";
        status.textContent = "ğŸ” Veri Ã§ekiliyor...";

        const s1 = `https://api.semanticscholar.org/graph/v1/paper/DOI:${encodeURIComponent(doi)}?fields=title,year,authors,references.paperId,references.title,references.year,citations.paperId,citations.title,citations.year`;
        const s2 = `https://api.openalex.org/works/https://doi.org/${encodeURIComponent(doi)}`;

        const [data1, data2] = await Promise.allSettled([fetchWithTimeout(s1), fetchWithTimeout(s2)]);
        const data = data1.value || data2.value;

        if (!data) {
          spinner.style.display = "none";
          status.textContent = "âŒ Veri alÄ±namadÄ±. DOI'yi kontrol edin.";
          return;
        }

        fullData = data;
        cache.set(doi, data);
        drawGraph(data);
        spinner.style.display = "none";
        status.textContent = `âœ… "${data.title || "Makale"}" yÃ¼klendi.`;
      }

      function drawGraph(data) {
        const yearLimit = yearFilter.value === "all" ? 0 : parseInt(yearFilter.value);
        const nodes = [], edges = [];
        const mainId = data.paperId || data.id || data.doi || "main";

        nodes.push({
          id: mainId,
          label: `[ANA]\n${(data.title || "BaÅŸlÄ±ksÄ±z").substring(0, 40)}...`,
          title: `${data.title}\n(${data.year || "?"})`,
          color: "#f0a30a",
          size: 40
        });

        const addNodes = (list, color, dir) => {
          (list || []).forEach(p => {
            if (p.year && p.year < yearLimit) return;
            const size = Math.min(15 + Math.random() * 10, 25);
            nodes.push({
              id: p.paperId || p.id || Math.random(),
              label: (p.title || "BaÅŸlÄ±k yok").substring(0, 35),
              color,
              title: `${p.title || "BaÅŸlÄ±k yok"}\nYÄ±l: ${p.year || "?"}`,
              url: `https://www.semanticscholar.org/paper/${p.paperId || ""}`,
              size
            });
            edges.push(dir === "ref" ? { from: mainId, to: p.paperId } : { from: p.paperId, to: mainId });
          });
        };

        addNodes(data.references, "#4285F4", "ref");
        addNodes(data.citations, "#34A853", "cit");

        const graphData = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
        network = new vis.Network(container, graphData, {
          nodes: { shape: "dot", font: { size: 14, color: "var(--text)" } },
          edges: { width: 1.8, smooth: { type: "dynamic" }, arrows: { to: { enabled: true, scaleFactor: 0.5 } } },
          physics: { stabilization: false, barnesHut: { springLength: 150 } }
        });

        network.on("click", p => {
          if (p.nodes.length > 0) {
            const node = graphData.nodes.get(p.nodes[0]);
            if (node.url) window.open(node.url, "_blank");
          }
        });
      }
    });
  </script>
</body>
</html>
