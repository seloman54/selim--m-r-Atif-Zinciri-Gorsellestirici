<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>By Selim - AtÄ±f Zinciri GÃ¶rselleÅŸtirici</title>
  <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.css" />
  <style>
    :root {
      --bg: linear-gradient(135deg, #f7f9ff, #e9eeff);
      --text: #111;
      --card-bg: #fff;
      --accent: #2b4eff;
      --shadow: rgba(43, 78, 255, 0.15);
    }
    body.dark {
      --bg: linear-gradient(135deg, #0f1116, #1a1d23);
      --text: #eee;
      --card-bg: #1f1f1f;
      --accent: #00bfff;
      --shadow: rgba(0, 191, 255, 0.25);
    }

    body {
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
      text-align: center;
      transition: 0.5s;
    }

    h1 {
      margin-top: 20px;
      color: var(--accent);
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }

    #controls {
      margin: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    input, button, select {
      padding: 10px 14px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 3px 6px var(--shadow);
      transition: 0.3s;
    }
    button:hover { transform: translateY(-1px); opacity: 0.9; }

    #network {
      width: 90%;
      height: 550px;
      background: var(--card-bg);
      margin: 0 auto;
      border-radius: 15px;
      box-shadow: 0 0 25px var(--shadow);
      transition: all 0.4s;
      position: relative;
    }

    #status { margin: 10px; font-weight: 500; }

    #spinner {
      display: none;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      margin: 10px auto;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    #notes {
      background: rgba(43,78,255,0.07);
      padding: 12px;
      border-radius: 10px;
      max-width: 700px;
      margin: 10px auto;
      font-size: 0.9em;
    }

    footer {
      margin: 25px 0;
      font-size: 0.8em;
      color: gray;
      opacity: 0.8;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    #centerButton {
      position: absolute;
      right: 10px;
      top: 10px;
      background: var(--accent);
      color: #fff;
      border-radius: 8px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 0.9em;
      z-index: 10;
      border: none;
    }
  </style>
</head>
<body>
  <h1>By Selim - AtÄ±f Zinciri GÃ¶rselleÅŸtirici</h1>

  <div id="controls">
    <input id="paperInput" type="text" placeholder="Makale DOI'si (Ã¶rn: 10.1038/nature12373)" />
    <button id="searchButton">Ara</button>
    <button id="sampleButton">ðŸŽ² Ã–rnek DOI</button>
    <select id="yearFilter">
      <option value="all">TÃ¼m YÄ±llar</option>
      <option value="2010">2010+</option>
      <option value="2015">2015+</option>
      <option value="2020">2020+</option>
    </select>
    <button id="saveButton">ðŸ’¾ GrafiÄŸi Kaydet</button>
    <button id="themeButton">ðŸŒ™ Gece Modu</button>
  </div>

  <div id="spinner"></div>
  <div id="status"></div>
  <div id="network"><button id="centerButton">ðŸŽ¯ Ortala</button></div>

  <div id="notes">
    ðŸ”¹ Mavi dÃ¼ÄŸÃ¼mler kaynakÃ§a, yeÅŸiller atÄ±f yapan makalelerdir.<br>
    ðŸ”¹ DÃ¼ÄŸÃ¼mlere tÄ±klayarak makale sayfasÄ±na gidebilirsiniz.<br>
    ðŸ”¹ AtÄ±f sayÄ±sÄ± yÃ¼ksek olanlar daha bÃ¼yÃ¼k gÃ¶rÃ¼nÃ¼r.<br>
    ðŸ”¹ Filtre menÃ¼sÃ¼nden yÄ±l aralÄ±ÄŸÄ±nÄ± seÃ§ebilirsiniz.
  </div>

  <footer>
    Â© 2025 <b>Selim Ã–MÃœR</b> | 
    <a href="mailto:omurselim@gmail.com">omurselim@gmail.com</a> |
    TÃ¼m haklarÄ± saklÄ±dÄ±r. Ä°zinsiz kopyalanamaz veya ticari amaÃ§la kullanÄ±lamaz.
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const paperInput = document.getElementById("paperInput");
      const searchButton = document.getElementById("searchButton");
      const sampleButton = document.getElementById("sampleButton");
      const saveButton = document.getElementById("saveButton");
      const themeButton = document.getElementById("themeButton");
      const yearFilter = document.getElementById("yearFilter");
      const spinner = document.getElementById("spinner");
      const status = document.getElementById("status");
      const container = document.getElementById("network");
      const centerButton = document.getElementById("centerButton");

      let network = null;
      let fullData = null;
      let graphData = null;

      const options = {
        nodes: { shape: "dot", font: { size: 14 } },
        edges: { width: 2, arrows: { to: { enabled: true, scaleFactor: 0.6 } } },
        physics: { stabilization: true }
      };

      themeButton.onclick = () => {
        document.body.classList.toggle("dark");
        themeButton.textContent = document.body.classList.contains("dark") ? "â˜€ï¸ GÃ¼ndÃ¼z Modu" : "ðŸŒ™ Gece Modu";
      };

      sampleButton.onclick = () => {
        const samples = ["10.1038/nature12373","10.1145/3368089.3409694","10.1109/5.771073","10.48550/arXiv.1706.03762"];
        paperInput.value = samples[Math.floor(Math.random() * samples.length)];
        searchPaper();
      };

      yearFilter.onchange = () => { if(fullData) drawGraph(fullData); };

      saveButton.onclick = () => {
        if (!network) return alert("Ã–nce bir grafik oluÅŸturun!");
        const canvas = network.canvas.frame.canvas;
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "atif-grafik.png";
        a.click();
      };

      centerButton.onclick = () => {
        if (network) network.fit({ animation: { duration: 800, easingFunction: "easeInOutQuad" } });
      };

      paperInput.onkeyup = (e) => { if (e.key === "Enter") searchPaper(); };
      searchButton.onclick = () => searchPaper();

      async function searchPaper() {
        const doi = paperInput.value.trim();
        if (!doi) { status.textContent = "âš ï¸ LÃ¼tfen DOI girin."; return; }
        spinner.style.display = "inline-block";
        status.textContent = "ðŸ” Veriler getiriliyor...";

        try {
          // Semantic Scholar dene
          const url = `https://api.semanticscholar.org/graph/v1/paper/DOI:${encodeURIComponent(doi)}?fields=title,year,authors,doi,paperId,url,references.paperId,references.title,references.year,references.doi,citations.paperId,citations.title,citations.year,citations.doi`;
          const res = await fetch(url);
          if (!res.ok) throw new Error("Semantic Scholar baÅŸarÄ±sÄ±z");
          const data = await res.json();
          fullData = data;
          drawGraph(data);
          status.textContent = `âœ… "${data.title}" baÅŸarÄ±yla gÃ¶rselleÅŸtirildi.`;
        } catch {
          // Crossref'e dÃ¼ÅŸ
          try {
            const res = await fetch(`https://api.crossref.org/works/${encodeURIComponent(doi)}`);
            const json = await res.json();
            const msg = json.message;
            const data = {
              title: msg.title[0],
              year: msg.created["date-parts"][0][0],
              doi: msg.DOI,
              references: [],
              citations: []
            };
            fullData = data;
            drawGraph(data);
            status.textContent = `â„¹ï¸ Crossref verileriyle gÃ¶steriliyor: "${data.title}"`;
          } catch (err2) {
            status.textContent = "âŒ DOI bulunamadÄ± veya API eriÅŸimi baÅŸarÄ±sÄ±z.";
          }
        } finally {
          spinner.style.display = "none";
        }
      }

      function drawGraph(data) {
        const yearLimit = yearFilter.value === "all" ? 0 : parseInt(yearFilter.value);
        const nodes = [], edges = [];
        const mainId = data.paperId || data.doi || data.title;
        nodes.push({
          id: mainId,
          label: `[ANA]\n${data.title.substring(0, 40)}...`,
          title: `${data.title}\n(${data.year || "?"})`,
          color: "#f0a30a",
          size: 35,
          url: data.url || `https://doi.org/${data.doi}`
        });

        const addNode = (list, color, direction) => {
          list.forEach(item => {
            if (item.year && item.year < yearLimit) return;
            const id = item.paperId || item.doi || item.title;
            nodes.push({
              id,
              label: (item.title || "BaÅŸlÄ±k yok").substring(0, 40),
              color,
              title: `${item.title}\nYÄ±l: ${item.year || "?"}`,
              url: item.doi ? `https://doi.org/${item.doi}` : (item.paperId ? `https://www.semanticscholar.org/paper/${item.paperId}` : null),
              size: 15 + Math.random() * 10
            });
            edges.push(direction === "ref" ? { from: mainId, to: id } : { from: id, to: mainId });
          });
        };

        addNode(data.references || [], "#4285F4", "ref");
        addNode(data.citations || [], "#34A853", "cit");

        graphData = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
        network = new vis.Network(container, graphData, options);

        network.on("click", p => {
          if (p.nodes.length > 0) {
            const node = graphData.nodes.get(p.nodes[0]);
            if (node.url) window.open(node.url, "_blank");
          }
        });

        container.animate([{ boxShadow: "0 0 0px var(--shadow)" }, { boxShadow: "0 0 25px var(--shadow)" }], {
          duration: 1000,
          iterations: 2,
        });
      }
    });
  </script>
</body>
</html>
